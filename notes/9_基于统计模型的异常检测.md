# 基于统计模型的异常检测

## 异常检测

1. **异常检测**(Anomaly detection)用于识别不匹配预期模式或数据集中的观测值

2. 与监督学习的区别

    * 异常只占数据量很小的一部分

    * 异常种类各异，且未来可能遇到的异常与已掌握的异常大不相同

3. 常见异常检测的算法

    * 基于统计模型(正态分布)

    * 基于邻近度(距离度量)

    * 基于密度

## 基于统计模型的异常检测

### 一维正态分布

1. 设样本特征服从正态分布，即$$x_j\sim N(\mu, \sigma^2)$$通过训练集估计参数$\mu$和$\sigma^2$$$\mu_j=\frac{1}{m}\sum_{i=1}^mx_j^{(i)}$$$$\sigma^2=\frac{1}{m}\sum_{i=1}^m\left(x_j^{(i)}-\mu_j\right)^2$$

2. 根据预测样本计算出在该分布中的概率密度$$\begin{aligned}p(x)&=\prod_{j=1}^nf(x_j;\mu_j,\sigma^2_j) \\ &=\prod_{j=1}^n\frac{1}{\sqrt{2\pi}\sigma_j}\exp\left(-\frac{(x_j-\mu_j)^2}{2\sigma^2_j}\right)\end{aligned}$$

    若$p(x) < \varepsilon$，认为该样本是异常的

### 多维正态分布

1. 设样本特征服从多维正态分布，即$$x_j\sim N(\mu, \Sigma)$$通过训练集估计参数$\mu$和协方差矩阵$\Sigma$$$\mu=\frac{1}{m}\sum_{i=1}^mx^{(i)}$$$$\Sigma=\frac{1}{m}\sum_{i=1}^m(x^{(i)}-\mu)(x^{(i)}-\mu)^T$$

2. 根据预测样本计算出在该分布中的概率密度$$p(x)=\frac{1}{(2\pi)^{n/2}|\Sigma|^{1/2}}\exp\left(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\right)$$

    若$p(x) < \varepsilon$，认为该样本是异常的

### 一维与多维模型的对比

1. 基于多维正态分布的模型可以对特征间存在关联的数据集进行异常检测，但往往计算开销更大

2. 应用多维正态分布的模型必须保证

    * $\Sigma$是可逆的

    * 训练集的大小$m$远大于特征维数$n$

### 特征变换

异常检测算法假设特征服从正态分布，对于不服从正态分布的数据集也能正常工作
但最好将其转换为正态分布，方法是对该特征$x_j$应用对数函数$\log(x_j+1)$或者幂函数$x_j^{\frac{1}{2}}$

## 异常检测系统的评估

1. 异常检测是无监督学习算法，无法通过结果$y$来判断异常是否真的存在，因此要用带标签的数据集来验证一个异常检测系统是否有效

2. 将数据集划分成训练集、交叉验证集和测试集三部分

    * 训练集由正常数据构成

    * 交叉验证集和测试集由大部分正常数据和一小部分的异常数据构成

3. 根据训练集数据构建计算模型$p(x)$

    对交叉验证集进行预测，根据$F_1-\text{score}$来选择合适的阈值$\varepsilon$